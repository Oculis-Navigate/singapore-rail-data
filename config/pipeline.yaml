pipeline:
  name: "MRT Data Pipeline"
  version: "2.0.0"
  description: "Singapore MRT/LRT station data extraction and enrichment"
  
  # Stage configurations
  stages:
    stage1_ingestion:
      enabled: true
      sources:
        - datagov
        - onemap
      cache_ttl_days: 30
      
    stage2_enrichment:
      enabled: true
      batch_size: 8
      delay_seconds: 2
      max_retries: 3
      retry_delay_seconds: 5
      daily_timeout_minutes: 90  # Stop after 90 minutes for free tier
      checkpoint_interval: 1     # Save after every N stations (1 = every station)
      max_llm_content_chars: 150000  # ~131K tokens context window for gpt-oss-120b
      sources:
        - fandom_wiki
        - openrouter_llm
        
    stage3_merger:
      enabled: true
      validation:
        schema_check: true
        completeness_check: true
        sanity_check: true
        
  # API configurations
  apis:
    onemap:
      base_url: "https://www.onemap.gov.sg/api"
      timeout: 30
      
    openrouter:
      base_url: "https://openrouter.ai/api/v1"
      model: "openai/gpt-oss-120b:free"
      timeout: 120
      max_tokens: 4000
      temperature: 0.1
      
    fandom:
      base_url: "https://singapore-mrt-lines.fandom.com/wiki"
      timeout: 30
      
  # Manual URL mappings for stations with unusual Fandom URLs
  # These override auto-resolution and are checked first
  url_mappings:
    # Known casing variations
    "Gardens By The Bay": "https://singapore-mrt-lines.fandom.com/wiki/Gardens_by_the_Bay_MRT_Station"
    "One-North": "https://singapore-mrt-lines.fandom.com/wiki/One-north_MRT_Station"
    "MacPherson": "https://singapore-mrt-lines.fandom.com/wiki/MacPherson_MRT_Station"
    "Harbourfront": "https://singapore-mrt-lines.fandom.com/wiki/HarbourFront_MRT_Station"
    "Bayfront Exit": "https://singapore-mrt-lines.fandom.com/wiki/Bayfront_MRT_Station"
  
  # Station code prefixes for extraction
  # Used to distinguish station codes from exit codes (A1, B2, etc.)
  station_code_prefixes:
    # Operational MRT Lines
    - NS  # North South Line
    - EW  # East West Line
    - NE  # North East Line
    - CC  # Circle Line
    - CE  # Circle Line Extension
    - DT  # Downtown Line
    - TE  # Thomson-East Coast Line
    - CG  # Changi Airport Line
    # Operational LRT Lines
    - BP  # Bukit Panjang LRT
    - SW  # Sengkang LRT West Loop
    - SE  # Sengkang LRT East Loop
    - PW  # Punggol LRT West Loop
    - PE  # Punggol LRT East Loop
    - STC # Sengkang Town Centre
    - PTC # Punggol Town Centre
    # Under Construction (Future Lines)
    - CR  # Cross Island Line (opening 2030-2032)
    - JS  # Jurong Region Line Central (opening 2027)
    - JW  # Jurong Region Line West (opening 2027)
    - JE  # Jurong Region Line East (opening 2028)
  
  # Expected counts for validation
  expected_stations: 187
  expected_lines: 9  # NSL, EWL, CCL, DTL, NEL, TEL, BPL, SKL, PGL
  
  # Output configuration
  output:
    versioning: true
    keep_last_n_versions: 10
    symlink_latest: true
    formats:
      - json
    
  # Logging
  logging:
    level: INFO
    format: structured  # structured or simple
    
alerting:
  enabled: true
  on_failure:
    - log
    - file
    # - email  # Add when email is configured
    # - webhook  # Add when webhook is configured

testing:
  expected_stations: 187
  min_enrichment_coverage: 0.7  # 70% of stations should have enrichment
  coordinate_bounds:
    lat_min: 1.0
    lat_max: 2.0
    lng_min: 103.0
    lng_max: 105.0